# Artillery.io performance tests


## Test Environment

Let's assume that our SUT (Service Under Test) is an internal Kubernetes service which has
ClusterIP `Service` created and is exposed on port `8088`. The service name is `testkube-api-server`
and is exposing the `/health` endpoint that we want to test.

To call the SUT inside a cluster:

```sh
curl http://testkube-api-server:8088/health
```

Output:

```sh
200 OK
```

## Create a test manifest

The Artillery tests are defined in declarative manner, as YAML files.  
Let's save our test into `test.yaml` file with content below:   

```yaml
config:
  target: "http://testkube-api-server:8088"
  phases:
    - duration: 6
      arrivalRate: 5
      name: Warm up
    - duration: 120
      arrivalRate: 5
      rampTo: 50
      name: Ramp up load
    - duration: 60
      arrivalRate: 50
      name: Sustained load
scenarios:
  - name: "Check health endpoint"
    flow:
      - get:
          url: "/health"
```

Now we can create a new Testkube test based on the saved Artillery test definition.

## **Create a New Testkube Test Script**

```sh
kubectl testkube create test --name artillery-api-test --file test.yaml --type artillery/test
```

Output:

```sh
Test created  ðŸ¥‡
```

## **Running a Test**

```sh
kubectl testkube run test artillery-api-test

Type          : postman/collection
Name          : artillery-api-test
Execution ID  : 615d6398b046f8fbd3d955d4
Execution name: openly-full-bream

Test queued for execution
Use the following command to get test execution details:
$ kubectl testkube get execution 615d6398b046f8fbd3d955d4

or watch test execution until complete:
$ kubectl testkube watch execution 615d6398b046f8fbd3d955d4
```

You can also   

Test runs can be named. If no name is passed, Testkube will autogenerate a name.

## **Getting Test Results**


Let's get back to our finished test

```sh
âžœ  testkube git:(jacek/docs/executors-docs-update) âœ— kubectl testkube get execution 628c957d2c8d8a7c1b1ead66                                                 
ID:        628c957d2c8d8a7c1b1ead66
Name:      tightly-adapting-hippo
Type:      artillery/test
Duration:  00:03:13

  Telemetry is on. Learn more: https://artillery.io/docs/resources/core/telemetry.html
Phase started: Warm up (index: 0, duration: 6s) 08:21:22(+0000)

Phase completed: Warm up (index: 0, duration: 6s) 08:21:28(+0000)

Phase started: Ramp up load (index: 1, duration: 120s) 08:21:28(+0000)

--------------------------------------
Metrics for period to: 08:21:30(+0000) (width: 6.167s)
--------------------------------------

http.codes.200: ................................................................ 41
http.request_rate: ............................................................. 9/sec
http.requests: ................................................................. 41
http.response_time:
  min: ......................................................................... 0
  max: ......................................................................... 5
  median: ...................................................................... 1
  p95: ......................................................................... 3
  p99: ......................................................................... 3
http.responses: ................................................................ 41
vusers.completed: .............................................................. 41
vusers.created: ................................................................ 41
vusers.created_by_name.Check health endpoint: .................................. 41
vusers.failed: ................................................................. 0
vusers.session_length:
  min: ......................................................................... 3.6
  max: ......................................................................... 73
  median: ...................................................................... 10.5
  p95: ......................................................................... 66
  p99: ......................................................................... 70.1


--------------------------------------
Metrics for period to: 08:21:40(+0000) (width: 9.893s)
--------------------------------------

http.codes.200: ................................................................ 68
http.request_rate: ............................................................. 7/sec
http.requests: ................................................................. 68
http.response_time:
  min: ......................................................................... 0
  max: ......................................................................... 3
  median: ...................................................................... 1
  p95: ......................................................................... 2
  p99: ......................................................................... 2
http.responses: ................................................................ 68
vusers.completed: .............................................................. 68
vusers.created: ................................................................ 68
vusers.created_by_name.Check health endpoint: .................................. 68
vusers.failed: ................................................................. 0
vusers.session_length:
  min: ......................................................................... 3
  max: ......................................................................... 9.8
  median: ...................................................................... 4.3
  p95: ......................................................................... 6.9
  p99: ......................................................................... 8.2


--------------------------------------
Metrics for period to: 08:21:50(+0000) (width: 9.753s)
--------------------------------------

http.codes.200: ................................................................ 103
http.request_rate: ............................................................. 14/sec
http.requests: ................................................................. 103
http.response_time:
  min: ......................................................................... 0
  max: ......................................................................... 8
  median: ...................................................................... 1
  p95: ......................................................................... 2
  p99: ......................................................................... 4
http.responses: ................................................................ 103
vusers.completed: .............................................................. 103
vusers.created: ................................................................ 103
vusers.created_by_name.Check health endpoint: .................................. 103
vusers.failed: ................................................................. 0
vusers.session_length:
  min: ......................................................................... 2.5
  max: ......................................................................... 16.2
  median: ...................................................................... 3.6
  p95: ......................................................................... 8.2
  p99: ......................................................................... 9.5


--------------------------------------
Metrics for period to: 08:22:00(+0000) (width: 9.895s)
--------------------------------------

http.codes.200: ................................................................ 152
http.request_rate: ............................................................. 16/sec
http.requests: ................................................................. 152
http.response_time:
  min: ......................................................................... 0
  max: ......................................................................... 3
  median: ...................................................................... 0
  p95: ......................................................................... 2
  p99: ......................................................................... 2
http.responses: ................................................................ 152
vusers.completed: .............................................................. 152
vusers.created: ................................................................ 152
vusers.created_by_name.Check health endpoint: .................................. 152
vusers.failed: ................................................................. 0
vusers.session_length:
  min: ......................................................................... 2.5
  max: ......................................................................... 9.4
  median: ...................................................................... 3.2
  p95: ......................................................................... 6
  p99: ......................................................................... 7.3


--------------------------------------
Metrics for period to: 08:22:10(+0000) (width: 9.93s)
--------------------------------------

http.codes.200: ................................................................ 199
http.request_rate: ............................................................. 22/sec
http.requests: ................................................................. 199
http.response_time:
  min: ......................................................................... 0
  max: ......................................................................... 4
  median: ...................................................................... 1
  p95: ......................................................................... 1
  p99: ......................................................................... 2
http.responses: ................................................................ 199
vusers.completed: .............................................................. 199
vusers.created: ................................................................ 199
vusers.created_by_name.Check health endpoint: .................................. 199
vusers.failed: ................................................................. 0
vusers.session_length:
  min: ......................................................................... 2.3
  max: ......................................................................... 11.1
  median: ...................................................................... 3.3
  p95: ......................................................................... 7.2
  p99: ......................................................................... 9.3


--------------------------------------
Metrics for period to: 08:22:20(+0000) (width: 9.858s)
--------------------------------------

http.codes.200: ................................................................ 205
http.request_rate: ............................................................. 20/sec
http.requests: ................................................................. 205
http.response_time:
  min: ......................................................................... 0
  max: ......................................................................... 2
  median: ...................................................................... 0
  p95: ......................................................................... 1
  p99: ......................................................................... 2
http.responses: ................................................................ 205
vusers.completed: .............................................................. 205
vusers.created: ................................................................ 205
vusers.created_by_name.Check health endpoint: .................................. 205
vusers.failed: ................................................................. 0
vusers.session_length:
  min: ......................................................................... 2.3
  max: ......................................................................... 7.8
  median: ...................................................................... 3.1
  p95: ......................................................................... 6.1
  p99: ......................................................................... 6.8


--------------------------------------
Metrics for period to: 08:22:30(+0000) (width: 9.932s)
--------------------------------------

http.codes.200: ................................................................ 271
http.request_rate: ............................................................. 29/sec
http.requests: ................................................................. 271
http.response_time:
  min: ......................................................................... 0
  max: ......................................................................... 11
  median: ...................................................................... 1
  p95: ......................................................................... 1
  p99: ......................................................................... 2
http.responses: ................................................................ 271
vusers.completed: .............................................................. 271
vusers.created: ................................................................ 271
vusers.created_by_name.Check health endpoint: .................................. 271
vusers.failed: ................................................................. 0
vusers.session_length:
  min: ......................................................................... 2.2
  max: ......................................................................... 15.1
  median: ...................................................................... 3.2
  p95: ......................................................................... 6.4
  p99: ......................................................................... 8.9


--------------------------------------
Metrics for period to: 08:22:40(+0000) (width: 9.928s)
--------------------------------------

http.codes.200: ................................................................ 314
http.request_rate: ............................................................. 33/sec
http.requests: ................................................................. 314
http.response_time:
  min: ......................................................................... 0
  max: ......................................................................... 9
  median: ...................................................................... 1
  p95: ......................................................................... 2
  p99: ......................................................................... 5
http.responses: ................................................................ 314
vusers.completed: .............................................................. 314
vusers.created: ................................................................ 314
vusers.created_by_name.Check health endpoint: .................................. 314
vusers.failed: ................................................................. 0
vusers.session_length:
  min: ......................................................................... 2.2
  max: ......................................................................... 13.1
  median: ...................................................................... 3.2
  p95: ......................................................................... 6.6
  p99: ......................................................................... 10.3


--------------------------------------
Metrics for period to: 08:22:50(+0000) (width: 9.898s)
--------------------------------------

http.codes.200: ................................................................ 347
http.request_rate: ............................................................. 36/sec
http.requests: ................................................................. 347
http.response_time:
  min: ......................................................................... 0
  max: ......................................................................... 4
  median: ...................................................................... 1
  p95: ......................................................................... 1
  p99: ......................................................................... 2
http.responses: ................................................................ 347
vusers.completed: .............................................................. 347
vusers.created: ................................................................ 347
vusers.created_by_name.Check health endpoint: .................................. 347
vusers.failed: ................................................................. 0
vusers.session_length:
  min: ......................................................................... 2.1
  max: ......................................................................... 12.6
  median: ...................................................................... 3.2
  p95: ......................................................................... 5.5
  p99: ......................................................................... 7.6


--------------------------------------
Metrics for period to: 08:23:00(+0000) (width: 9.894s)
--------------------------------------

http.codes.200: ................................................................ 405
http.request_rate: ............................................................. 42/sec
http.requests: ................................................................. 405
http.response_time:
  min: ......................................................................... 0
  max: ......................................................................... 12
  median: ...................................................................... 1
  p95: ......................................................................... 2
  p99: ......................................................................... 4
http.responses: ................................................................ 405
vusers.completed: .............................................................. 405
vusers.created: ................................................................ 405
vusers.created_by_name.Check health endpoint: .................................. 405
vusers.failed: ................................................................. 0
vusers.session_length:
  min: ......................................................................... 2.2
  max: ......................................................................... 21.5
  median: ...................................................................... 3.1
  p95: ......................................................................... 7.3
  p99: ......................................................................... 10.5


--------------------------------------
Metrics for period to: 08:23:10(+0000) (width: 9.929s)
--------------------------------------

http.codes.200: ................................................................ 429
http.request_rate: ............................................................. 43/sec
http.requests: ................................................................. 429
http.response_time:
  min: ......................................................................... 0
  max: ......................................................................... 5
  median: ...................................................................... 1
  p95: ......................................................................... 1
  p99: ......................................................................... 3
http.responses: ................................................................ 429
vusers.completed: .............................................................. 429
vusers.created: ................................................................ 429
vusers.created_by_name.Check health endpoint: .................................. 429
vusers.failed: ................................................................. 0
vusers.session_length:
  min: ......................................................................... 2
  max: ......................................................................... 12.9
  median: ...................................................................... 3.1
  p95: ......................................................................... 5.8
  p99: ......................................................................... 8.1


Phase completed: Ramp up load (index: 1, duration: 120s) 08:23:28(+0000)

Phase started: Sustained load (index: 2, duration: 60s) 08:23:28(+0000)

--------------------------------------
Metrics for period to: 08:23:20(+0000) (width: 9.929s)
--------------------------------------

http.codes.200: ................................................................ 491
http.request_rate: ............................................................. 50/sec
http.requests: ................................................................. 491
http.response_time:
  min: ......................................................................... 0
  max: ......................................................................... 5
  median: ...................................................................... 1
  p95: ......................................................................... 1
  p99: ......................................................................... 3
http.responses: ................................................................ 491
vusers.completed: .............................................................. 491
vusers.created: ................................................................ 491
vusers.created_by_name.Check health endpoint: .................................. 491
vusers.failed: ................................................................. 0
vusers.session_length:
  min: ......................................................................... 2.1
  max: ......................................................................... 19.7
  median: ...................................................................... 3.2
  p95: ......................................................................... 6.2
  p99: ......................................................................... 9.3


--------------------------------------
Metrics for period to: 08:23:30(+0000) (width: 9.938s)
--------------------------------------

http.codes.200: ................................................................ 493
http.request_rate: ............................................................. 50/sec
http.requests: ................................................................. 493
http.response_time:
  min: ......................................................................... 0
  max: ......................................................................... 5
  median: ...................................................................... 1
  p95: ......................................................................... 2
  p99: ......................................................................... 3
http.responses: ................................................................ 493
vusers.completed: .............................................................. 493
vusers.created: ................................................................ 493
vusers.created_by_name.Check health endpoint: .................................. 493
vusers.failed: ................................................................. 0
vusers.session_length:
  min: ......................................................................... 1.9
  max: ......................................................................... 34.2
  median: ...................................................................... 3
  p95: ......................................................................... 6.1
  p99: ......................................................................... 9.5


--------------------------------------
Metrics for period to: 08:23:40(+0000) (width: 9.936s)
--------------------------------------

http.codes.200: ................................................................ 500
http.request_rate: ............................................................. 50/sec
http.requests: ................................................................. 500
http.response_time:
  min: ......................................................................... 0
  max: ......................................................................... 17
  median: ...................................................................... 1
  p95: ......................................................................... 2
  p99: ......................................................................... 7.9
http.responses: ................................................................ 500
vusers.completed: .............................................................. 500
vusers.created: ................................................................ 500
vusers.created_by_name.Check health endpoint: .................................. 500
vusers.failed: ................................................................. 0
vusers.session_length:
  min: ......................................................................... 2
  max: ......................................................................... 25.5
  median: ...................................................................... 3
  p95: ......................................................................... 7.2
  p99: ......................................................................... 16.3


--------------------------------------
Metrics for period to: 08:23:50(+0000) (width: 9.935s)
--------------------------------------

http.codes.200: ................................................................ 500
http.request_rate: ............................................................. 50/sec
http.requests: ................................................................. 500
http.response_time:
  min: ......................................................................... 0
  max: ......................................................................... 9
  median: ...................................................................... 1
  p95: ......................................................................... 2
  p99: ......................................................................... 5
http.responses: ................................................................ 500
vusers.completed: .............................................................. 500
vusers.created: ................................................................ 500
vusers.created_by_name.Check health endpoint: .................................. 500
vusers.failed: ................................................................. 0
vusers.session_length:
  min: ......................................................................... 1.9
  max: ......................................................................... 27.7
  median: ...................................................................... 2.8
  p95: ......................................................................... 8.8
  p99: ......................................................................... 12.8


--------------------------------------
Metrics for period to: 08:24:00(+0000) (width: 9.934s)
--------------------------------------

http.codes.200: ................................................................ 500
http.request_rate: ............................................................. 50/sec
http.requests: ................................................................. 500
http.response_time:
  min: ......................................................................... 0
  max: ......................................................................... 10
  median: ...................................................................... 1
  p95: ......................................................................... 2
  p99: ......................................................................... 5
http.responses: ................................................................ 500
vusers.completed: .............................................................. 500
vusers.created: ................................................................ 500
vusers.created_by_name.Check health endpoint: .................................. 500
vusers.failed: ................................................................. 0
vusers.session_length:
  min: ......................................................................... 1.9
  max: ......................................................................... 21
  median: ...................................................................... 2.9
  p95: ......................................................................... 7.2
  p99: ......................................................................... 14.4


--------------------------------------
Metrics for period to: 08:24:10(+0000) (width: 9.936s)
--------------------------------------

http.codes.200: ................................................................ 500
http.request_rate: ............................................................. 50/sec
http.requests: ................................................................. 500
http.response_time:
  min: ......................................................................... 0
  max: ......................................................................... 11
  median: ...................................................................... 0
  p95: ......................................................................... 2
  p99: ......................................................................... 4
http.responses: ................................................................ 500
vusers.completed: .............................................................. 500
vusers.created: ................................................................ 500
vusers.created_by_name.Check health endpoint: .................................. 500
vusers.failed: ................................................................. 0
vusers.session_length:
  min: ......................................................................... 1.9
  max: ......................................................................... 24.3
  median: ...................................................................... 2.7
  p95: ......................................................................... 6.5
  p99: ......................................................................... 15.6


Phase completed: Sustained load (index: 2, duration: 60s) 08:24:28(+0000)

--------------------------------------
Metrics for period to: 08:24:20(+0000) (width: 9.935s)
--------------------------------------

http.codes.200: ................................................................ 500
http.request_rate: ............................................................. 50/sec
http.requests: ................................................................. 500
http.response_time:
  min: ......................................................................... 0
  max: ......................................................................... 9
  median: ...................................................................... 0
  p95: ......................................................................... 1
  p99: ......................................................................... 4
http.responses: ................................................................ 500
vusers.completed: .............................................................. 500
vusers.created: ................................................................ 500
vusers.created_by_name.Check health endpoint: .................................. 500
vusers.failed: ................................................................. 0
vusers.session_length:
  min: ......................................................................... 1.8
  max: ......................................................................... 20.8
  median: ...................................................................... 2.8
  p95: ......................................................................... 7.2
  p99: ......................................................................... 11.6


--------------------------------------
Metrics for period to: 08:24:30(+0000) (width: 9.753s)
--------------------------------------

http.codes.200: ................................................................ 451
http.request_rate: ............................................................. 50/sec
http.requests: ................................................................. 451
http.response_time:
  min: ......................................................................... 0
  max: ......................................................................... 16
  median: ...................................................................... 0
  p95: ......................................................................... 2
  p99: ......................................................................... 4
http.responses: ................................................................ 451
vusers.completed: .............................................................. 451
vusers.created: ................................................................ 451
vusers.created_by_name.Check health endpoint: .................................. 451
vusers.failed: ................................................................. 0
vusers.session_length:
  min: ......................................................................... 1.7
  max: ......................................................................... 24.5
  median: ...................................................................... 2.7
  p95: ......................................................................... 8.1
  p99: ......................................................................... 16


All VUs finished. Total time: 3 minutes, 9 seconds

--------------------------------
Summary report @ 08:24:30(+0000)
--------------------------------

http.codes.200: ................................................................ 6469
http.request_rate: ............................................................. 36/sec
http.requests: ................................................................. 6469
http.response_time:
  min: ......................................................................... 0
  max: ......................................................................... 17
  median: ...................................................................... 1
  p95: ......................................................................... 2
  p99: ......................................................................... 4
http.responses: ................................................................ 6469
vusers.completed: .............................................................. 6469
vusers.created: ................................................................ 6469
vusers.created_by_name.Check health endpoint: .................................. 6469
vusers.failed: ................................................................. 0
vusers.session_length:
  min: ......................................................................... 1.7
  max: ......................................................................... 73
  median: ...................................................................... 3
  p95: ......................................................................... 7.2
  p99: ......................................................................... 12.6
Log file: /tmp/test-report.json

Status Test execution completed with success ðŸ¥‡

```

## **Summary**

Testkube simplifies running tests inside a cluster and stores tests and tests results for later use.
